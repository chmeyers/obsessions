# Midgame obsessions events
namespace = obsessions_midgame

# A leader died or was fired.
# Scope = Country
# From = Leader
country_event = {
	id = obsessions_midgame.50
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = {
			has_leader_flag = obsession_obsessed_midgame
		}
	}

	immediate = {
		# If an obsessed leader dies, the event chain is cancelled.
		if = {
			limit = { has_event_chain = black_hole_obsession_chain }
			end_event_chain = black_hole_obsession_chain
		}
		if = {
			limit = { has_event_chain = pulsar_obsession_chain }
			end_event_chain = pulsar_obsession_chain
		}
		if = {
			limit = { has_event_chain = neutron_obsession_chain }
			end_event_chain = neutron_obsession_chain
		}
		if = {
			limit = { has_event_chain = tomb_obsession_chain }
			end_event_chain = tomb_obsession_chain
		}
		if = {
			limit = { has_event_chain = gaia_obsession_chain }
			end_event_chain = gaia_obsession_chain
		}
	}
}

country_event = {
	id = obsessions_midgame.1
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		# Only trigger for a human in single player games that haven't already spawned
		# a possible obsession anomaly by the midgame.
		NOT = { has_global_flag = obsessions_mod_spawned_obsession }
		is_multiplayer = no
		is_ai = no
	}

	immediate = {
		# One third chance of spawning when trigger met. Since this event fires at the midgame,
		# wait a random time before triggering the actual event.
		random_list = {
			1 = {
				country_event = { id = obsessions_midgame.2 days = 1000 random = 500 }
			}
			2 = {} # 2/3 chance of nothing
		}
	}
	
}

country_event = {
	id = obsessions_midgame.2
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		# Check whether they have an eligible scientist for a midgame obsession
		# The scientist must be skill level <=5, young-ish, and idle or assigned to assisting research.
		random_owned_leader = {
			limit = {
				leader_class = scientist
				has_skill <= 5
				leader_age <= 80
				is_event_leader = no
				NOT = { has_leader_flag = obsession_obsessed }
				OR = {
					is_idle = yes
					AND = {
						exists = fleet
						NOR = {
							# assist_research_order is deliberately not listed here
							fleet = { has_fleet_order = survey_planet_order }
							fleet = { has_fleet_order = research_anomaly_order }
							fleet = { has_fleet_order = evade_hostiles_order }
							fleet = { has_fleet_order = auto_explore_order }
							fleet = { has_fleet_order = explore_bypass_order }
							fleet = { has_fleet_order = experimental_subspace_navigation_fleet_order }
							fleet = { has_fleet_order = excavate_archaeological_site_fleet_order }
						}
					}
				}
			}
			# Found an eligible scientist. Trigger an obsession on them.
			set_global_flag = obsessions_mod_spawned_obsession
			save_global_event_target_as = obsessions_midgame_scientist
			random_list = {
				# Black Holes
				# 1 = {
				# 	modifier = {
				# 		add = 10
				# 		is_specialist_physics = yes
				# 	}
				# 	modifier = {
				# 		add = 100
				# 		has_trait = leader_trait_expertise_computing
				# 	}
				# 	leader_event = { id = obsessions_midgame.101 }
				# }
				# # Pulsars
				# 1 = {
				# 	modifier = {
				# 		add = 10
				# 		is_specialist_physics = yes
				# 	}
				# 	modifier = {
				# 		add = 100
				# 		has_trait = leader_trait_expertise_field_manipulation
				# 	}
				# 	leader_event = { id = obsessions_midgame.102 }
				# }
				# # Neutron Stars
				# 1 = {
				# 	modifier = {
				# 		add = 10
				# 		OR = {
				# 			is_specialist_physics = yes
				# 			is_specialist_engineer = yes
				# 		}
				# 	}
				# 	modifier = {
				# 		add = 100
				# 		OR = {
				# 			has_trait = leader_trait_expertise_particles
				# 			has_trait = leader_trait_expertise_propulsion
				# 		}
				# 	}
				# 	leader_event = { id = obsessions_midgame.103 }
				# }
				# # Tomb Worlds
				# 1 = {
				# 	modifier = {
				# 		add = 10
				# 		is_specialist_society = yes
				# 	}
				# 	modifier = {
				# 		add = 100
				# 		has_trait = leader_trait_expertise_new_worlds
				# 	}
				# 	leader_event = { id = obsessions_midgame.104 }
				# }
				# Gaia Worlds
				1 = {
					modifier = {
						add = 10
						is_specialist_society = yes
					}
					modifier = {
						add = 100
						has_trait = leader_trait_expertise_biology
					}
					leader_event = { id = obsessions_midgame.105 }
				}
				# # Empire Capitals
				# 1 = {
				# 	modifier = {
				# 		add = 10
				# 		is_specialist_society = yes
				# 	}
				# 	modifier = {
				# 		add = 100
				# 		has_trait = leader_trait_expertise_statecraft
				# 	}
				# 	leader_event = { id = obsessions_midgame.106 }
				# }
				# # Enclaves
				# 1 = {
				# 	modifier = {
				# 		add = 10
				# 		is_specialist_society = yes
				# 	}
				# 	modifier = {
				# 		add = 100
				# 		has_trait = leader_trait_expertise_military_theory
				# 	}
				# 	leader_event = { id = obsessions_midgame.107 }
				# }
				# # Relic/Ecu Worlds
				# 1 = {
				# 	modifier = {
				# 		add = 10
				# 		is_specialist_engineer = yes
				# 	}
				# 	modifier = {
				# 		add = 100
				# 		has_trait = leader_trait_expertise_industry
				# 	}
				# 	leader_event = { id = obsessions_midgame.108 }
				# }
				# # Megastructures
				# 1 = {
				# 	modifier = {
				# 		add = 10
				# 		is_specialist_engineer = yes
				# 	}
				# 	modifier = {
				# 		add = 100
				# 		has_trait = leader_trait_expertise_voidcraft
				# 	}
				# 	leader_event = { id = obsessions_midgame.109 }
				# }
				# # L-Gates
				# 1 = {
				# 	modifier = {
				# 		add = 10
				# 		is_specialist_engineer = yes
				# 	}
				# 	modifier = {
				# 		add = 100
				# 		has_trait = leader_trait_expertise_materials
				# 	}
				# 	leader_event = { id = obsessions_midgame.110 }
				# }
			}
		}
	}
}

# Black Holes
# obsessions_midgame.101
leader_event = {
	id = obsessions_midgame.101
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		# Make sure there are enough of the right object to trigger on.
		if = {
			limit = {
				count_system = {
					limit = {
						is_star_class = sc_black_hole
						NOT = { has_star_flag = hostile_system }
						NOT = { has_star_flag = marauder_system }
						is_pirate_system = no
					}
					count >= 7
				}
			}
			owner = { country_event = { id = obsessions_midgame.201 scopes = { from = root } } }
		}
	}
}

country_event = {
	id = obsessions_midgame.201
	title = "obsessions_midgame.201.name"
	desc = "obsessions_midgame.201.desc"
	picture = GFX_evt_black_hole
	is_triggered_only = yes

	immediate = {
		# Create Obsessed scientist
		from = {
			set_leader_flag = obsession_obsessed_midgame
			add_trait = leader_trait_obsessed_1
		}
	}

	option = {
		name = "obsessions_midgame.very_well"
		begin_event_chain = {
			event_chain = black_hole_obsession_chain
			target = root
		}
		tooltip = { from = { add_trait = leader_trait_obsessed_1 } }
		hidden_effect = { country_event = { id = obsessions_midgame.301 } }
	}

	option = {
		name = "obsessions_midgame.fired"
		from = { kill_leader = { show_notification = no } }
	}
}

country_event = {
	id = obsessions_midgame.301
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		while = {
			count = 10
			random_system = {
				limit = {
					is_star_class = sc_black_hole
					NOT = { has_star_flag = hostile_system }
					NOT = { has_star_flag = marauder_system }
					is_pirate_system = no
					NOT = { has_star_flag = obsession_midgame_project }
				}
				set_star_flag = obsession_midgame_project
				root = {
					enable_special_project = {
						name = "OBSESSIONS_MIDGAME_BLACK_HOLE_PROJECT"
						location = prev.system_star
						owner = root
					}
				}
			}
		}
	}
}

ship_event = {
	id = obsessions_midgame.401
	title = "obsessions_midgame.401.name"
	desc = "obsessions_midgame.401.desc"
	picture = GFX_evt_black_hole
	location = root

	is_triggered_only = yes

	immediate = {
		owner = {
			add_event_chain_counter = {
				event_chain = black_hole_obsession_chain
				counter = obsession_black_holes_analyzed
				amount = 1
			}
		}
	}

	option = {
		name = obsessions_midgame.401.b.1
		name = obsessions_midgame.401.b.2
		name = obsessions_midgame.401.b.3
		name = obsessions_midgame.401.b.4
		name = obsessions_midgame.401.b.5
		custom_tooltip = obsessions_midgame.401.b.tooltip
		hidden_effect = {
			if = {
				limit = { leader = { leader_age <= 30 } }
				# Too young!
				owner = {
					country_event = { id = obsessions_midgame.503 scopes = { from = root.leader } }
				}
			}
			else = {
				owner = {
					country_event = { id = obsessions_midgame.501 scopes = { from = root.leader } }
				}
			}
		}
	}

	option = {
		name = obsessions_midgame.401.c.1
		name = obsessions_midgame.401.c.2
		name = obsessions_midgame.401.c.3
		name = obsessions_midgame.401.c.4
		name = obsessions_midgame.401.c.5
		hidden_effect = {
			if = {
				limit = {
					owner = {
						OR = {
							has_completed_event_chain_counter = {
								event_chain = black_hole_obsession_chain
								counter = obsession_black_holes_analyzed
							}
							NOT = { has_special_project = OBSESSIONS_MIDGAME_BLACK_HOLE_PROJECT }
						}
					}
				}
				owner = {
					country_event = { id = obsessions_midgame.502 scopes = { from = root.leader } }
				}
			}
		}
	}
}

country_event = {
	id = obsessions_midgame.501
	title = "obsessions_midgame.501.name"
	desc = "obsessions_midgame.501.desc"
	picture = GFX_evt_black_hole
	is_triggered_only = yes

	auto_opens = yes

	immediate = {
		from = {
			export_trigger_value_to_variable = {
				trigger = leader_age
				variable = obsession_previous_age
			}
			change_variable = {
				which = obsession_previous_age
				value = -20
			}
			set_age = obsession_previous_age
			change_variable = {
				which = obsession_black_hole_flybys
				value = 1
			}
		}
	}

	option = {
		trigger = {
			owner = {
				NOR = {
					has_completed_event_chain_counter = {
						event_chain = black_hole_obsession_chain
						counter = obsession_black_holes_analyzed
					}
					NOT = { has_special_project = OBSESSIONS_MIDGAME_BLACK_HOLE_PROJECT }
				}
			}
		}
		name = obsessions_midgame.501.a
	}

	option = {
		trigger = {
			owner = {
				OR = {
					has_completed_event_chain_counter = {
						event_chain = black_hole_obsession_chain
						counter = obsession_black_holes_analyzed
					}
					NOT = { has_special_project = OBSESSIONS_MIDGAME_BLACK_HOLE_PROJECT }
				}
			}
		}
		name = obsessions_midgame.501.b
		# Go to end of chain
		owner = {
			country_event = { id = obsessions_midgame.502 scopes = { from = from } }
		}
	}
}

country_event = {
	id = obsessions_midgame.502
	title = "obsessions_midgame.502.name"
	picture = GFX_evt_black_hole
	is_triggered_only = yes

	auto_opens = yes

	desc = {
		exclusive_trigger = {
			from = {
				check_variable = {
					which = obsession_black_hole_flybys
					value <= 2
				}
			}
		}
		text = "obsessions_midgame.502.desc_more"
	}
	desc = "obsessions_midgame.502.desc"

	# End of chain, give rewards.
	option = {
		name = obsessions_midgame.502.a
		end_event_chain = black_hole_obsession_chain
		from = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
			if = {
				limit = { check_variable = { which = obsession_black_hole_flybys value <= 2 } }
				add_experience = 200
				owner = {
					add_monthly_resource_mult = {
						resource = physics_research
						value = @tier2researchreward
						min = @tier2researchmin
						max = @tier2researchmax
					}
				}
			}
			else_if = {
				limit = { check_variable = { which = obsession_black_hole_flybys value <= 4 } }
				add_experience = 500
				owner = {
					add_monthly_resource_mult = {
						resource = physics_research
						value = @tier4researchreward
						min = @tier4researchmin
						max = @tier4researchmax
					}
				}
			}
			else = {
				# They managed to do all 5, this took them at least 30 years...
				add_experience = 1000
				owner = {
					add_monthly_resource_mult = {
						resource = physics_research
						value = @tier5researchreward
						min = @tier5researchmin
						max = @tier5researchmax
					}
				}
			}
		}
	}
}

country_event = {
	id = obsessions_midgame.503
	title = "obsessions_midgame.503.name"
	desc = "obsessions_midgame.503.desc"
	picture = GFX_evt_black_hole
	is_triggered_only = yes

	auto_opens = yes

	# They were too young, so they died.
	immediate = {
		from = {
			save_global_event_target_as = obsessed_scientist_blackhole
			exile_leader_as = obsessed_scientist_blackhole
		}
	}

	option = {
		name = obsessions_midgame.503.a
		end_event_chain = black_hole_obsession_chain
		tooltip = {
			from = { kill_leader = { show_notification = no } }
		}
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier1researchreward
			min = @tier1researchmin
			max = @tier1researchmax
		}
		hidden_effect = {
			country_event = {
				id = obsessions_midgame.504 days = 10800
			}
		}
	}
}

country_event = {
	id = obsessions_midgame.504
	title = "obsessions_midgame.504.name"
	desc = "obsessions_midgame.504.desc"
	picture = GFX_evt_black_hole
	is_triggered_only = yes

	auto_opens = yes

	option = {
		name = obsessions_midgame.504.a
		custom_tooltip = obsessions_midgame.504.a.tooltip
		hidden_effect = {
			clone_leader = {
				target = event_target:obsessed_scientist_blackhole
				effect = {
					save_event_target_as = obsessed_scientist_blackhole_returns
				}
			}
			# For some reason this didn't work when done inside the effect{} above.
			event_target:obsessed_scientist_blackhole_returns = {
				set_age = 30
				remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
				add_trait = leader_trait_obsession_fulfilled
			}
		}
	}

	option = {
		name = obsessions_midgame.504.b
	}
}

# Pulsars
leader_event = {
	id = obsessions_midgame.102
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		# Make sure there are enough of the right object to trigger on.
		if = {
			limit = {
				count_system = {
					limit = {
						is_star_class = sc_pulsar
						NOT = { has_star_flag = hostile_system }
						NOT = { has_star_flag = marauder_system }
						is_pirate_system = no
					}
					count >= 7
				}
			}
			owner = { country_event = { id = obsessions_midgame.202 scopes = { from = root } } }
		}
	}
}

country_event = {
	id = obsessions_midgame.202
	title = "obsessions_midgame.202.name"
	desc = "obsessions_midgame.202.desc"
	picture = GFX_evt_star_pulsar
	is_triggered_only = yes

	immediate = {
		# Create Obsessed scientist
		from = {
			set_leader_flag = obsession_obsessed_midgame
			add_trait = leader_trait_obsessed_1
		}
	}

	option = {
		name = "obsessions_midgame.very_well"
		begin_event_chain = {
			event_chain = pulsar_obsession_chain
			target = root
		}
		tooltip = { from = { add_trait = leader_trait_obsessed_1 } }
		hidden_effect = { country_event = { id = obsessions_midgame.302 } }
	}

	option = {
		name = "obsessions_midgame.fired"
		from = { kill_leader = { show_notification = no } }
	}
}

country_event = {
	id = obsessions_midgame.302
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		while = {
			count = 10
			random_system = {
				limit = {
					is_star_class = sc_pulsar
					NOT = { has_star_flag = hostile_system }
					NOT = { has_star_flag = marauder_system }
					is_pirate_system = no
					NOT = { has_star_flag = obsession_midgame_project }
				}
				set_star_flag = obsession_midgame_project
				root = {
					enable_special_project = {
						name = "OBSESSIONS_MIDGAME_PULSAR_PROJECT"
						location = prev.system_star
						owner = root
					}
				}
			}
		}
	}
}

ship_event = {
	id = obsessions_midgame.402
	title = "obsessions_midgame.402.name"
	picture = GFX_evt_star_pulsar
	location = root

	is_triggered_only = yes

	desc = {
		exclusive_trigger = {
			leader = {
				check_variable = {
					which = obsession_pulsar_flybys
					value > 0
				}
			}
		}
		text = "obsessions_midgame.402.desc_closer"
	}
	desc = "obsessions_midgame.402.desc"

	immediate = {
		owner = {
			add_event_chain_counter = {
				event_chain = pulsar_obsession_chain
				counter = obsession_pulsars_analyzed
				amount = 1
			}
		}
	}

	option = {
		name = obsessions_midgame.402.b.1
		name = obsessions_midgame.402.b.2
		name = obsessions_midgame.402.b.3
		name = obsessions_midgame.402.b.4
		name = obsessions_midgame.402.b.5
		custom_tooltip = obsessions_midgame.402.b.tooltip
		hidden_effect = {
			leader = {
				set_max_shield_level_variable = yes
				subtract_variable = {
					which = shield_level
					value = obsession_pulsar_flybys
				}
			}
			if = {
				limit = { leader = { check_variable = { which = shield_level value <= 0 } } }
				owner = {
					country_event = { id = obsessions_midgame.506 scopes = { from = root } }
				}
			}
			else = {
				owner = {
					country_event = { id = obsessions_midgame.507 scopes = { from = root.leader } }
				}
			}
		}
	}

	option = {
		name = obsessions_midgame.402.c.1
		name = obsessions_midgame.402.c.2
		name = obsessions_midgame.402.c.3
		name = obsessions_midgame.402.c.4
		name = obsessions_midgame.402.c.5
		hidden_effect = {
			if = {
				limit = {
					owner = {
						OR = {
							has_completed_event_chain_counter = {
								event_chain = pulsar_obsession_chain
								counter = obsession_pulsars_analyzed
							}
							NOT = { has_special_project = OBSESSIONS_MIDGAME_PULSAR_PROJECT }
						}
					}
				}
				owner = {
					country_event = { id = obsessions_midgame.505 scopes = { from = root.leader } }
				}
			}
		}
	}
}

country_event = {
	id = obsessions_midgame.505
	title = "obsessions_midgame.505.name"
	picture = GFX_evt_star_pulsar
	is_triggered_only = yes

	auto_opens = yes

	desc = {
		exclusive_trigger = {
			from = {
				check_variable = {
					which = obsession_pulsar_flybys
					value <= 2
				}
			}
		}
		text = "obsessions_midgame.505.desc_more"
	}
	desc = "obsessions_midgame.505.desc"

	# End of chain, give rewards.
	option = {
		name = obsessions_midgame.505.a
		end_event_chain = pulsar_obsession_chain
		from = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
			if = {
				limit = { check_variable = { which = obsession_pulsar_flybys value <= 2 } }
				add_experience = 200
				owner = {
					add_monthly_resource_mult = {
						resource = physics_research
						value = @tier2researchreward
						min = @tier2researchmin
						max = @tier2researchmax
					}
				}
			}
			else_if = {
				limit = { check_variable = { which = obsession_pulsar_flybys value <= 4 } }
				add_experience = 500
				owner = {
					give_next_shield_tech_option_effect = yes
				}
			}
			else = {
				add_experience = 1000
				owner = {
					give_next_shield_tech_option_effect = yes
				}
			}
		}
	}
}

country_event = {
	id = obsessions_midgame.506
	title = "obsessions_midgame.506.name"
	desc = "obsessions_midgame.506.desc"
	picture = GFX_evt_star_pulsar
	is_triggered_only = yes

	auto_opens = yes

	# The shields weren't strong enough, so the ship was destroyed.
	immediate = {
		from = {
			destroy_ship = this
		}
	}

	option = {
		name = obsessions_midgame.506.a
		end_event_chain = pulsar_obsession_chain
	}
}


country_event = {
	id = obsessions_midgame.507
	title = "obsessions_midgame.507.name"
	picture = GFX_evt_star_pulsar
	is_triggered_only = yes
	auto_opens = yes

	desc = {
		exclusive_trigger = {
			from = { check_variable = {
				which = shield_level
				value <= 1
			} }
		}
		text = "obsessions_midgame.507.desc_close" 
	}
	desc = "obsessions_midgame.507.desc"

	immediate = {
		from = {
			change_variable = {
				which = obsession_pulsar_flybys
				value = 1
			}
		}
	}

	option = {
		trigger = {
			owner = {
				NOR = {
					has_completed_event_chain_counter = {
						event_chain = pulsar_obsession_chain
						counter = obsession_pulsars_analyzed
					}
					NOT = { has_special_project = OBSESSIONS_MIDGAME_PULSAR_PROJECT }
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
		name = obsessions_midgame.507.a
	}

	option = {
		trigger = {
			owner = {
				OR = {
					has_completed_event_chain_counter = {
						event_chain = pulsar_obsession_chain
						counter = obsession_pulsars_analyzed
					}
					NOT = { has_special_project = OBSESSIONS_MIDGAME_PULSAR_PROJECT }
				}
			}
		}
		name = obsessions_midgame.507.b
		# Go to end of chain
		owner = {
			country_event = { id = obsessions_midgame.505 scopes = { from = from } }
		}
	}
}

# Neutron Stars
leader_event = {
	id = obsessions_midgame.103
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		# Make sure there are enough of the right object to trigger on.
		if = {
			limit = {
				count_system = {
					limit = {
						is_star_class = sc_neutron_star
						NOT = { has_star_flag = hostile_system }
						NOT = { has_star_flag = marauder_system }
						is_pirate_system = no
					}
					count >= 7
				}
			}
			owner = { country_event = { id = obsessions_midgame.203 scopes = { from = root } } }
		}
	}
}

country_event = {
	id = obsessions_midgame.203
	title = "obsessions_midgame.203.name"
	desc = "obsessions_midgame.203.desc"
	picture = GFX_evt_star_neutron
	is_triggered_only = yes

	immediate = {
		# Create Obsessed scientist
		from = {
			set_leader_flag = obsession_obsessed_midgame
			add_trait = leader_trait_obsessed_1
		}
	}

	option = {
		name = "obsessions_midgame.very_well"
		begin_event_chain = {
			event_chain = neutron_obsession_chain
			target = root
		}
		tooltip = { from = { add_trait = leader_trait_obsessed_1 } }
		hidden_effect = { country_event = { id = obsessions_midgame.303 } }
	}

	option = {
		name = "obsessions_midgame.fired"
		from = { kill_leader = { show_notification = no } }
	}
}

country_event = {
	id = obsessions_midgame.303
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		while = {
			count = 10
			random_system = {
				limit = {
					is_star_class = sc_neutron_star
					NOT = { has_star_flag = hostile_system }
					NOT = { has_star_flag = marauder_system }
					is_pirate_system = no
					NOT = { has_star_flag = obsession_midgame_project }
				}
				set_star_flag = obsession_midgame_project
				root = {
					enable_special_project = {
						name = "OBSESSIONS_MIDGAME_NEUTRON_PROJECT"
						location = prev.system_star
						owner = root
					}
				}
			}
		}
	}
}

ship_event = {
	id = obsessions_midgame.403
	title = "obsessions_midgame.403.name"
	picture = GFX_evt_star_neutron
	location = root

	is_triggered_only = yes

	desc = {
		exclusive_trigger = {
			leader = {
				check_variable = {
					which = obsession_neutron_flybys
					value > 0
				}
			}
		}
		text = "obsessions_midgame.403.desc_closer"
	}
	desc = "obsessions_midgame.403.desc"

	immediate = {
		owner = {
			add_event_chain_counter = {
				event_chain = neutron_obsession_chain
				counter = obsession_neutrons_analyzed
				amount = 1
			}
		}
	}

	option = {
		name = obsessions_midgame.403.b.1
		name = obsessions_midgame.403.b.2
		name = obsessions_midgame.403.b.3
		name = obsessions_midgame.403.b.4
		name = obsessions_midgame.403.b.5
		custom_tooltip = obsessions_midgame.403.b.tooltip
		hidden_effect = {
			owner = {
				country_event = { id = obsessions_midgame.509 scopes = { from = root.leader } }
			}
		}
	}

	option = {
		name = obsessions_midgame.403.c.1
		name = obsessions_midgame.403.c.2
		name = obsessions_midgame.403.c.3
		name = obsessions_midgame.403.c.4
		name = obsessions_midgame.403.c.5
		hidden_effect = {
			if = {
				limit = {
					owner = {
						OR = {
							has_completed_event_chain_counter = {
								event_chain = neutron_obsession_chain
								counter = obsession_neutrons_analyzed
							}
							NOT = { has_special_project = OBSESSIONS_MIDGAME_NEUTRON_PROJECT }
						}
					}
				}
				owner = {
					country_event = { id = obsessions_midgame.508 scopes = { from = root.leader } }
				}
			}
		}
	}
}

country_event = {
	id = obsessions_midgame.508
	title = "obsessions_midgame.508.name"
	picture = GFX_evt_star_neutron
	is_triggered_only = yes

	auto_opens = yes

	desc = {
		exclusive_trigger = {
			from = {
				check_variable = {
					which = obsession_neutron_flybys
					value <= 2
				}
			}
		}
		text = "obsessions_midgame.508.desc_more"
	}
	desc = "obsessions_midgame.508.desc"

	# End of chain, give rewards.
	option = {
		name = obsessions_midgame.508.a
		end_event_chain = neutron_obsession_chain
		from = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
			if = {
				limit = { check_variable = { which = obsession_neutron_flybys value <= 2 } }
				add_experience = 200
				owner = {
					add_monthly_resource_mult = {
						resource = physics_research
						value = @tier2researchreward
						min = @tier2researchmin
						max = @tier2researchmax
					}
				}
			}
			else_if = {
				limit = { check_variable = { which = obsession_neutron_flybys value <= 4 } }
				add_experience = 500
				owner = {
					give_next_propulsion_tech_option_effect = yes
				}
			}
			else = {
				add_experience = 1000
				owner = {
					give_next_propulsion_tech_option_effect = yes
				}
			}
		}
	}
}

country_event = {
	id = obsessions_midgame.509
	title = "obsessions_midgame.509.name"
	picture = GFX_evt_star_neutron
	is_triggered_only = yes
	auto_opens = yes

	desc = "obsessions_midgame.509.desc"

	immediate = {
		from = {
			change_variable = {
				which = obsession_neutron_flybys
				value = 1
			}
		}
	}

	option = {
		trigger = {
			owner = {
				NOR = {
					has_completed_event_chain_counter = {
						event_chain = neutron_obsession_chain
						counter = obsession_neutrons_analyzed
					}
					NOT = { has_special_project = OBSESSIONS_MIDGAME_NEUTRON_PROJECT }
				}
			}
		}
		name = obsessions_midgame.509.a
	}

	option = {
		trigger = {
			owner = {
				OR = {
					has_completed_event_chain_counter = {
						event_chain = neutron_obsession_chain
						counter = obsession_neutrons_analyzed
					}
					NOT = { has_special_project = OBSESSIONS_MIDGAME_NEUTRON_PROJECT }
				}
			}
		}
		name = obsessions_midgame.509.b
		# Go to end of chain
		owner = {
			country_event = { id = obsessions_midgame.508 scopes = { from = from } }
		}
	}
}

# Tomb Worlds
leader_event = {
	id = obsessions_midgame.104
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		# Make sure there are enough of the right object to trigger on.
		if = {
			limit = {
				count_galaxy_planet = {
					limit = {
						is_planet_class = pc_nuked
						NOT = { solar_system = { has_star_flag = hostile_system } }
						NOT = { solar_system = { has_star_flag = marauder_system } }
						solar_system = { is_pirate_system = no }
					}
					count >= 5
				}
			}
			owner = { country_event = { id = obsessions_midgame.204 scopes = { from = root } } }
		}
	}
}

country_event = {
	id = obsessions_midgame.204
	title = "obsessions_midgame.204.name"
	desc = "obsessions_midgame.204.desc"
	picture = GFX_evt_tomb_world
	is_triggered_only = yes

	immediate = {
		# Create Obsessed scientist
		from = {
			set_leader_flag = obsession_obsessed_midgame
			add_trait = leader_trait_obsessed_1
		}
	}

	option = {
		name = "obsessions_midgame.very_well"
		begin_event_chain = {
			event_chain = tomb_obsession_chain
			target = root
		}
		tooltip = { from = { add_trait = leader_trait_obsessed_1 } }
		hidden_effect = { country_event = { id = obsessions_midgame.304 } }
	}

	option = {
		name = "obsessions_midgame.fired"
		from = { kill_leader = { show_notification = no } }
	}
}

country_event = {
	id = obsessions_midgame.304
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		while = {
			count = 8
			random_galaxy_planet = {
				limit = {
					is_planet_class = pc_nuked
					NOT = { solar_system = { has_star_flag = hostile_system } }
					NOT = { solar_system = { has_star_flag = marauder_system } }
					solar_system = { is_pirate_system = no }
					NOT = { has_planet_flag = obsession_midgame_project }
				}
				set_planet_flag = obsession_midgame_project
				root = {
					enable_special_project = {
						name = "OBSESSIONS_MIDGAME_TOMB_PROJECT"
						location = prev
						owner = root
					}
				}
			}
		}
	}
}

ship_event = {
	id = obsessions_midgame.404
	title = "obsessions_midgame.404.name"
	picture = GFX_evt_tomb_world
	location = root

	is_triggered_only = yes

	desc = {
		exclusive_trigger = {
			leader = { check_variable = { which = obsession_tomb_flybys value = 2 } }
		}
		text = "obsessions_midgame.404.desc_1"
	}
	desc = {
		exclusive_trigger = {
			leader = { check_variable = { which = obsession_tomb_flybys value = 3 } }
		}
		text = "obsessions_midgame.404.desc_2"
	}
	desc = {
		exclusive_trigger = {
			leader = { check_variable = { which = obsession_tomb_flybys value = 4 } }
		}
		text = "obsessions_midgame.404.desc_3"
	}
	desc = "obsessions_midgame.404.desc"

	immediate = {
		owner = {
			add_event_chain_counter = {
				event_chain = tomb_obsession_chain
				counter = obsession_tombs_analyzed
				amount = 1
			}
		}
		# There doesn't appear to be a way to read the value of chain counter variable,
		# so we have a duplicate variable.
		leader = {
			change_variable = {
				which = obsession_tomb_flybys
				value = 1
			}
			if = {
				limit = {
					check_variable = { which = obsession_tomb_flybys value = 2 }
				}
				# Time to change to a cockroach
				create_species = {
					name = "NAME_Gregor_Samsa"
					plural = "NAME_Gregor_Samsa"
					class = "ART"
					portrait = pre_art11
					traits = {
						ideal_planet_class = "pc_nuked"
						trait = trait_survivor
						trait = trait_erudite
						trait = trait_venerable
						trait = trait_quick_learners
						trait = trait_talented
					}
					effect = {
						save_global_event_target_as = obsession_gregor_samsa
					}
				}
				if = {
					limit = { species = { is_robotic = yes } }
					set_leader_flag = obsessions_was_robotic
				}
				change_species = event_target:obsession_gregor_samsa
				if = {
					limit = {
						NOT = { has_trait = leader_trait_scientist_erudite }
					}
					add_trait = leader_trait_scientist_erudite
					add_ruler_trait = leader_trait_ruler_erudite
				}
			}
			if = {
				limit = {
					check_variable = { which = obsession_tomb_flybys value = 4 }
				}
				# Change name to Gregor Samsa, if it didn't already happen.
				set_name = "NAME_Gregor_Samsa"
			}
		}
	}

	option = {
		trigger = {
			leader = { check_variable = { which = obsession_tomb_flybys value = 1 } }
		}
		name = obsessions_midgame.404.a.1
	}

	option = {
		trigger = {
			leader = { check_variable = { which = obsession_tomb_flybys value = 2 } }
		}
		name = obsessions_midgame.404.a.2
		owner = { country_event = { id = obsessions_midgame.510 scopes = { from = root } } }
		hidden_effect = {
			leader = { set_leader_flag = obsessions_talked_one }
		}
	}

	option = {
		trigger = {
			leader = { check_variable = { which = obsession_tomb_flybys value = 3 } }
		}
		name = obsessions_midgame.404.a.3
		owner = { country_event = { id = obsessions_midgame.512 scopes = { from = root } } }
		hidden_effect = {
			leader = { set_leader_flag = obsessions_talked_two }
		}
	}

	option = {
		trigger = {
			leader = { check_variable = { which = obsession_tomb_flybys value = 4 } }
		}
		name = obsessions_midgame.404.a.4
		owner = { country_event = { id = obsessions_midgame.513 scopes = { from = root } } }
	}

	option = {
		trigger = {
			OR = {
				leader = { check_variable = { which = obsession_tomb_flybys value = 2 } }
				leader = { check_variable = { which = obsession_tomb_flybys value = 3 } }
			}
		}
		name = obsessions_midgame.404.b
	}
}

country_event = {
	id = obsessions_midgame.510
	title = "obsessions_midgame.510.name"
	desc = "obsessions_midgame.510.desc"
	location = from
	is_triggered_only = yes
	diplomatic = yes
	diplomatic_title = BLANK_STRING

	picture_event_data = {
		portrait = event_target:obsessions_midgame_scientist
		room = "ethic_spaceship_room"
	}

	option = {
		allow = {
			hidden_trigger = {
				NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = asked_cockroach } }
			}
		}
		name = obsessions_midgame.510.a
		is_dialog_only = yes
		response_text = obsessions_midgame.510.a.response
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = asked_cockroach
			}
		}
	}

	option = {
		trigger = {
			event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_was_robotic }
		}
		name = obsessions_midgame.510.b
		is_dialog_only = yes
		response_text = obsessions_midgame.510.b.response
	}

	option = {
		allow = {
			hidden_trigger = {
				event_target:obsessions_midgame_scientist = { has_leader_flag = asked_cockroach }
			}
		}
		name = obsessions_midgame.510.c
		owner = {
			enable_special_project = {
				name = "OBSESSIONS_MOD_STUDY_GREGOR_PROJECT"
				location = from
				owner = root.owner
			}
		}
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = obsessions_study_project
			}
		}
	}

	option = {
		name = obsessions_midgame.510.d
		allow = {
			hidden_trigger = {
				event_target:obsessions_midgame_scientist = { has_leader_flag = asked_cockroach }
			}
		}
		owner = {
			enable_special_project = {
				name = "OBSESSIONS_MOD_FIX_GREGOR_PROJECT"
				location = from
				owner = root.owner
			}
		}
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = obsessions_fix_project
			}
		}
	}

	option = {
		name = obsessions_midgame.510.e
		custom_tooltip = obsessions_midgame.510.e.tooltip
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				change_variable = { which = obsessions_compassion value = 1 }
				change_variable = { which = obsessions_science value = 1 }
			}
		}
	}

	option = {
		allow = {
			OR = {
				has_ethic = ethic_fanatic_xenophobe
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_authoritarian
				has_ethic = ethic_authoritarian
				has_ethic = ethic_gestalt_consciousness
			}
		}
		name = obsessions_midgame.510.f
		event_target:obsessions_midgame_scientist = {
			kill_leader = { show_notification = no }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}

	option = {
		allow = {
			NOR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_egalitarian
				has_ethic = ethic_egalitarian
			}
		}
		name = obsessions_midgame.510.g
		event_target:obsessions_midgame_scientist = {
			kill_leader = { show_notification = no }
		}
	}
}

country_event = {
	id = obsessions_midgame.511
	title = "obsessions_midgame.511.name"
	desc = "obsessions_midgame.511.desc"
	picture = GFX_evt_tomb_world
	is_triggered_only = yes

	immediate = {
		event_target:obsessions_midgame_scientist = {
			# Increase the variable matching the project they did.
			if = {
				limit = { has_leader_flag = obsessions_study_project }
				change_variable = { which = obsessions_science value = 2 }
			}
			else = {
				change_variable = { which = obsessions_compassion value = 2 }
			}
		}
	}

	option = {
		name = "obsessions_midgame.511.a"
		add_monthly_resource_mult = {
			resource = society_research
			value = @tier1researchreward
			min = @tier1researchmin
			max = @tier1researchmax
		}
	}

	option = {
		name = "obsessions_midgame.511.b"
		event_target:obsessions_midgame_scientist = {
			kill_leader = { show_notification = no }
		}
	}
}

country_event = {
	id = obsessions_midgame.512
	title = "obsessions_midgame.512.name"
	desc = "obsessions_midgame.512.desc"
	location = from
	is_triggered_only = yes
	diplomatic = yes
	diplomatic_title = BLANK_STRING

	desc = {
		exclusive_trigger = {
			event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_no_more }
		}
		text = obsessions_midgame.512.e.response
	}

	picture_event_data = {
		portrait = event_target:obsessions_midgame_scientist
		room = "ethic_spaceship_room"
	}

	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_talked_one } }
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_no_more } }
		}
		allow = {
			hidden_trigger = {
				NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = asked_cockroach } }
			}
		}
		name = obsessions_midgame.512.a
		is_dialog_only = yes
		response_text = obsessions_midgame.512.a.response
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = asked_cockroach
			}
		}
	}

	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_no_more } }
		}
		allow = {
			hidden_trigger = {
				NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_wrong_name } }
			}
		}
		name = obsessions_midgame.512.b
		is_dialog_only = yes
		response_text = obsessions_midgame.512.b.response
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = obsessions_wrong_name
			}
		}
	}

	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_no_more } }
		}
		name = obsessions_midgame.512.c
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				change_variable = { which = obsessions_science value = 1 }
				set_name = "NAME_Gregor_Samsa"
			}
		}
	}

	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_no_more } }
		}
		name = obsessions_midgame.512.d
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				change_variable = { which = obsessions_compassion value = 1 }
			}
		}
		event_target:obsessions_midgame_scientist = {
			set_name = "NAME_Gregor_Samsa"
		}
	}

	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_no_more } }
		}
		name = obsessions_midgame.512.e
		# Set flag and reload this same event to re-evaluate triggers.
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = obsessions_no_more
				set_name = "NAME_Gregor_Samsa"
			}
			country_event = { id = obsessions_midgame.512 }
		}
	}

	option = {
		trigger = {
			event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_no_more }
		}
		name = obsessions_midgame.512.f
	}

	option = {
		trigger = {
			event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_no_more }
		}
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= 1000
				}
			}
		}
		name = obsessions_midgame.512.g
		owner = {
			add_resource = {
				energy = -1000
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			end_event_chain = tomb_obsession_chain
		}
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
		}
	}

	option = {
		trigger = {
			event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_no_more }
		}
		name = obsessions_midgame.512.h
		event_target:obsessions_midgame_scientist = {
			kill_leader = { show_notification = no }
		}
	}
}

country_event = {
	id = obsessions_midgame.513
	title = "obsessions_midgame.513.name"
	desc = "obsessions_midgame.513.desc"
	location = from
	is_triggered_only = yes
	diplomatic = yes
	diplomatic_title = BLANK_STRING

	desc = {
		exclusive_trigger = {
			event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_rejoin }
		}
		text = obsessions_midgame.513.desc_rejoin
	}

	picture_event_data = {
		portrait = event_target:obsessions_midgame_scientist
		room = "ethic_spaceship_room"
	}

	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_talked_one } }
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_talked_two } }
		}
		allow = {
			hidden_trigger = {
				NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = asked_cockroach } }
			}
		}
		name = obsessions_midgame.513.a
		is_dialog_only = yes
		response_text = obsessions_midgame.513.a.response
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = asked_cockroach
			}
		}
	}

	# Failure option for compassion
	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_rejoin } }
			event_target:obsessions_midgame_scientist = {
				check_variable = { which = obsessions_compassion value < 2 }
			}
		}
		allow = {
			hidden_trigger = {
				NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_for_compassion } }
			}
		}
		name = obsessions_midgame.513.b
		is_dialog_only = yes
		response_text = obsessions_midgame.513.b.response
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = obsessions_for_compassion
			}
		}
	}

	# Failure option for science
	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_rejoin } }
			event_target:obsessions_midgame_scientist = {
				check_variable = { which = obsessions_science value < 2 }
			}
		}
		allow = {
			hidden_trigger = {
				NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_for_science } }
			}
		}
		name = obsessions_midgame.513.c
		is_dialog_only = yes
		response_text = obsessions_midgame.513.c.response
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = obsessions_for_science
			}
		}
	}

	# Success option for compassion
	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_rejoin } }
			event_target:obsessions_midgame_scientist = {
				check_variable = { which = obsessions_compassion value >= 2 }
			}
		}
		allow = {
			hidden_trigger = {
				NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_for_compassion } }
			}
		}
		name = obsessions_midgame.513.b
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = obsessions_rejoin
				set_leader_flag = obsessions_for_compassion
			}
			country_event = { id = obsessions_midgame.513 }
		}
	}

	# Success option for science
	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_rejoin } }
			event_target:obsessions_midgame_scientist = {
				check_variable = { which = obsessions_science value >= 2 }
			}
		}
		allow = {
			hidden_trigger = {
				NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_for_science } }
			}
		}
		name = obsessions_midgame.513.c
		hidden_effect = {
			event_target:obsessions_midgame_scientist = {
				set_leader_flag = obsessions_rejoin
				set_leader_flag = obsessions_for_science
			}
			country_event = { id = obsessions_midgame.513 }
		}
	}

	option = {
		trigger = {
			NOT = { event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_rejoin } }
		}
		allow = {
			hidden_trigger = {
				event_target:obsessions_midgame_scientist = {
					has_leader_flag = obsessions_for_science
					has_leader_flag = obsessions_for_compassion
				}
			}
		}
		name = obsessions_midgame.513.d
		event_target:obsessions_midgame_scientist = {
			kill_leader = { show_notification = no }
		}
		end_event_chain = tomb_obsession_chain
	}

	option = {
		trigger = {
			event_target:obsessions_midgame_scientist = { has_leader_flag = obsessions_rejoin }
		}
		name = obsessions_midgame.513.e
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
		}
		owner = {
			if = {
				limit = { NOT = { has_technology = tech_tomb_world_adaption }  }
				give_technology = {
					tech = tech_tomb_world_adaption
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier4researchreward
					min = @tier4researchmin
					max = @tier4researchmax
				}
			}
		}
		end_event_chain = tomb_obsession_chain
	}
}

# Gaia Worlds
leader_event = {
	id = obsessions_midgame.105
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		# Only trigger if the Spiritualist Fallen Empire exists and has holy worlds.
		if = {
			limit = {
				count_galaxy_planet = {
					limit = {
						is_planet_class = pc_gaia
					}
					count >= 4
				}
				count_galaxy_planet = {
					limit = {
						is_planet_class = pc_gaia
						OR = {
							has_planet_flag = holy_world_1
							has_planet_flag = holy_world_2
							has_planet_flag = holy_world_3
							has_planet_flag = holy_world_4
						}
					}
					count >= 3
				}
				# Only trigger if they are not yet awakened, even though it's okay if they
				# awaken in the middle of the chain.
				any_country = { has_ai_personality = fallen_empire_spiritualist }
			}
			owner = { country_event = { id = obsessions_midgame.205 scopes = { from = root } } }
		}
	}
}

country_event = {
	id = obsessions_midgame.205
	title = "obsessions_midgame.205.name"
	desc = "obsessions_midgame.205.desc"
	picture = GFX_evt_gaia
	is_triggered_only = yes

	immediate = {
		# Create Obsessed scientist
		from = {
			set_leader_flag = obsession_obsessed_midgame
			add_trait = leader_trait_obsessed_1
		}
	}

	option = {
		name = "obsessions_midgame.very_well"
		begin_event_chain = {
			event_chain = gaia_obsession_chain
			target = root
		}
		tooltip = { from = { add_trait = leader_trait_obsessed_1 } }
		hidden_effect = { country_event = { id = obsessions_midgame.305 } }
	}

	option = {
		name = "obsessions_midgame.fired"
		from = { kill_leader = { show_notification = no } }
	}
}

country_event = {
	id = obsessions_midgame.305
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		while = {
			count = 4
			random_galaxy_planet = {
				limit = {
					is_planet_class = pc_gaia
					OR = {
						has_planet_flag = holy_world_1
						has_planet_flag = holy_world_2
						has_planet_flag = holy_world_3
						has_planet_flag = holy_world_4
					}
					NOT = { has_planet_flag = obsession_midgame_project }
				}
				set_planet_flag = obsession_midgame_project
				enable_special_project = {
					name = "OBSESSIONS_MIDGAME_GAIA_PROJECT"
					location = this
					owner = root
				}
			}
		}
		# Pick up to two non-holy worlds
		while = {
			count = 2
			random_galaxy_planet = {
				limit = {
					is_planet_class = pc_gaia
					is_capital = no
					NOT = { has_planet_flag = obsession_midgame_project }
				}
				set_planet_flag = obsession_midgame_project
				enable_special_project = {
					name = "OBSESSIONS_MIDGAME_GAIA_PROJECT"
					location = this
					owner = root
				}
			}
		}
	}
}

ship_event = {
	id = obsessions_midgame.405
	title = "obsessions_midgame.405.name"
	picture = GFX_evt_gaia
	location = from # planet

	is_triggered_only = yes

	desc = {
		exclusive_trigger = {
			from = {
				OR = {
					has_planet_flag = holy_world_1
					has_planet_flag = holy_world_2
					has_planet_flag = holy_world_3
					has_planet_flag = holy_world_4
				}
			}
		}
		text = "obsessions_midgame.405.desc_holy"
	}
	desc = "obsessions_midgame.405.desc"

	immediate = {
		owner = {
			add_event_chain_counter = {
				event_chain = gaia_obsession_chain
				counter = obsession_gaias_analyzed
				amount = 1
			}
		}
	}

	option = {
		name = obsessions_midgame.405.a
		hidden_effect = {
			if = {
				limit = {
					from = {
						OR = {
							has_planet_flag = holy_world_1
							has_planet_flag = holy_world_2
							has_planet_flag = holy_world_3
							has_planet_flag = holy_world_4
						}
					}
				}
				random_country = {
					limit = {
						OR = {
							has_ai_personality = awakened_fallen_empire_spiritualist
							has_ai_personality = fallen_empire_spiritualist
						}
					}
					save_global_event_target_as = outraged_FE
				}
				owner = { country_event = { id = obsessions_midgame.514 days = 5 } }
			}
		}
	}

	option = {
		exclusive_trigger = {
			owner = {
				OR = {
					has_completed_event_chain_counter = {
						event_chain = gaia_obsession_chain
						counter = obsession_gaias_analyzed
					}
					NOT = { has_special_project = OBSESSIONS_MIDGAME_GAIA_PROJECT }
				}
			}
		}
		name = obsessions_midgame.405.b
		leader = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
	}
}

country_event = {
	id = obsessions_midgame.514
	title = "obsessions_midgame.514.name"
	desc = "obsessions_midgame.514.desc"
	show_sound = event_ship_bridge
	location = event_target:outraged_FE.capital_scope
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:outraged_FE
		planet_background = event_target:outraged_FE
		graphical_culture = event_target:outraged_FE
		city_level = event_target:outraged_FE
		room = event_target:outraged_FE.ruler
	}

	option = {
		trigger = {
			has_relic = r_severed_head
		}
		name = "obsessions_midgame.514.a"
		custom_tooltip = "obsessions_midgame.514.a.tooltip"
		hidden_effect = {
			country_event = { id = obsessions_midgame.515 }
		}
	}

	option = {
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
				any_pop_faction = {
					is_pop_faction_type = "traditionalist"
				}
			}
		}
		name = "obsessions_midgame.514.b"
		custom_tooltip = "obsessions_midgame.514.b.tooltip"
		hidden_effect = {
			country_event = { id = obsessions_midgame.516 }
		}
	}

	option = {
		trigger = {
			NOR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
				any_pop_faction = {
					is_pop_faction_type = "traditionalist"
				}
			}
		}
		name = "obsessions_midgame.514.b"
		custom_tooltip = "obsessions_midgame.514.b.tooltip_lie"
		hidden_effect = {
			set_country_flag = obsessions_liar
			country_event = { id = obsessions_midgame.516 }
		}
	}

	option = {
		name = "obsessions_midgame.514.c"
		hidden_effect = {
			country_event = { id = obsessions_midgame.517 }
		}
	}

	option = {
		name = "obsessions_midgame.514.d"
		hidden_effect = {
			country_event = { id = obsessions_midgame.518 }
		}
	}

	option = {
		name = "obsessions_midgame.514.e"
		hidden_effect = {
			country_event = { id = obsessions_midgame.519 }
		}
	}
}

country_event = {
	id = obsessions_midgame.515
	title = "obsessions_midgame.515.name"
	desc = "obsessions_midgame.515.desc"
	location = event_target:outraged_FE.capital_scope
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:outraged_FE
		planet_background = event_target:outraged_FE
		graphical_culture = event_target:outraged_FE
		city_level = event_target:outraged_FE
		room = event_target:outraged_FE.ruler
	}

	option = {
		name = "obsessions_midgame.515.a"
		leader = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
	}
}

country_event = {
	id = obsessions_midgame.516
	title = "obsessions_midgame.516.name"
	location = event_target:outraged_FE.capital_scope
	is_triggered_only = yes

	desc = {
		exclusive_trigger = {
			has_country_flag = obsessions_liar
		}
		text = "obsessions_midgame.516.desc.lie"
	}
	desc = "obsessions_midgame.516.desc"

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:outraged_FE
		planet_background = event_target:outraged_FE
		graphical_culture = event_target:outraged_FE
		city_level = event_target:outraged_FE
		room = event_target:outraged_FE.ruler
	}

	option = {
		trigger = {
			NOT = { has_country_flag = obsessions_liar }
		}
		name = "obsessions_midgame.516.a"
		custom_tooltip = "obsessions_midgame.516.a.tooltip"
		leader = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }
			}
			while = {
				count = 100
				random_owned_pop = {
					limit = {
						NOT = { has_ethic = "ethic_spiritualist" }
					}
					pop_change_ethic = "ethic_spiritualist"
				}
			}
		}
	}

	option = {
		trigger = {
			NOT = { has_country_flag = obsessions_liar }
		}
		allow = {
			NOR = {
				has_ethic = ethic_fanatic_xenophobe
				has_ethic = ethic_xenophobe
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_inwards_perfection
				has_valid_civic = civic_machine_terminator
			}
		}
		name = "obsessions_midgame.516.b"
		custom_tooltip = "obsessions_midgame.516.b.tooltip"
		leader = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }
			}
		}
	}
	option = {
		trigger = {
			NOT = { has_country_flag = obsessions_liar }
		}
		allow = {
			OR = {
				has_ethic = ethic_fanatic_xenophobe
				has_ethic = ethic_xenophobe
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
				has_valid_civic = civic_inwards_perfection
				has_valid_civic = civic_machine_terminator
			}
		}
		name = "obsessions_midgame.516.c"
		custom_tooltip = "obsessions_midgame.516.c.tooltip"
		leader = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_demand }
			}
		}
	}

	option = {
		trigger = {
			has_country_flag = obsessions_liar
		}
		name = "obsessions_midgame.516.d"
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_demand }
			}
		}
	}

	option = {
		trigger = {
			has_country_flag = obsessions_liar
		}
		name = "obsessions_midgame.516.e"
		event_target:obsessions_midgame_scientist = { kill_leader = { show_notification = no } }
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = encroaching_scientists }
			}
		}
	}
}

country_event = {
	id = obsessions_midgame.517
	title = "obsessions_midgame.517.name"
	location = event_target:outraged_FE.capital_scope
	is_triggered_only = yes

	desc = "obsessions_midgame.517.desc"

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:outraged_FE
		planet_background = event_target:outraged_FE
		graphical_culture = event_target:outraged_FE
		city_level = event_target:outraged_FE
		room = event_target:outraged_FE.ruler
	}

	option = {
		name = "obsessions_midgame.517.a"
		custom_tooltip = "obsessions_midgame.517.a.tooltip"
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_demand }
			}
		}
	}

	option = {
		name = "obsessions_midgame.517.b"
		custom_tooltip = "obsessions_midgame.517.b.tooltip"
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			# They get a lesser trait, not fulfillment.
			if = {
				limit = { NOT = { has_trait = leader_trait_expertise_biology } }
				add_trait = leader_trait_expertise_biology
			}
			else_if = {
				limit = { NOT = { has_trait = leader_trait_adaptable } }
				add_trait = leader_trait_adaptable
			}
			else = {
				add_trait = leader_trait_resilient
			}
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }
			}
		}
	}

	option = {
		name = "obsessions_midgame.517.c"
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = encroaching_scientists }
			}
		}
	}
}

country_event = {
	id = obsessions_midgame.518
	title = "obsessions_midgame.518.name"
	location = event_target:outraged_FE.capital_scope
	is_triggered_only = yes

	desc = "obsessions_midgame.518.desc"

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:outraged_FE
		planet_background = event_target:outraged_FE
		graphical_culture = event_target:outraged_FE
		city_level = event_target:outraged_FE
		room = event_target:outraged_FE.ruler
	}

	option = {
		name = "obsessions_midgame.518.a"
		custom_tooltip = "obsessions_midgame.518.a.tooltip"
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			# Wake up FE and make it start a war
			owner = {
				save_event_target_as = FE_outrager
			}
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_demand }
				set_country_flag = holy_world_killed # Not really killed, but this flag let's us wake it up.
				country_event = { id = fallen_empires_awakening.1 days = 40 }
			}
		}
	}

	option = {
		name = "obsessions_midgame.518.b"
		custom_tooltip = "obsessions_midgame.518.b.tooltip"
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			# They get a lesser trait, not fulfillment.
			if = {
				limit = { NOT = { has_trait = leader_trait_expertise_biology } }
				add_trait = leader_trait_expertise_biology
			}
			else_if = {
				limit = { NOT = { has_trait = leader_trait_adaptable } }
				add_trait = leader_trait_adaptable
			}
			else = {
				add_trait = leader_trait_resilient
			}
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_demand }
			}
		}
	}

	option = {
		name = "obsessions_midgame.518.c"
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = encroaching_scientists }
			}
		}
	}
}

country_event = {
	id = obsessions_midgame.519
	title = "obsessions_midgame.519.name"
	location = event_target:outraged_FE.capital_scope
	is_triggered_only = yes

	desc = "obsessions_midgame.519.desc"

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:outraged_FE
		planet_background = event_target:outraged_FE
		graphical_culture = event_target:outraged_FE
		city_level = event_target:outraged_FE
		room = event_target:outraged_FE.ruler
	}

	option = {
		name = "obsessions_midgame.519.a"
		custom_tooltip = "obsessions_midgame.519.a.tooltip"
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			# Wake up FE and make it start a war
			owner = {
				save_event_target_as = FE_outrager
			}
			event_target:outraged_FE = {
				set_country_flag = holy_world_killed # Not really killed, but this flag let's us wake it up.
				country_event = { id = fallen_empires_awakening.1 days = 40 }
			}
		}
	}

	option = {
		name = "obsessions_midgame.519.b"
		custom_tooltip = "obsessions_midgame.519.b.tooltip"
		event_target:obsessions_midgame_scientist = {
			remove_trait_effect = { TRAIT = leader_trait_obsessed_1 }
			add_trait = leader_trait_obsession_fulfilled
		}
		owner = {
			end_event_chain = gaia_obsession_chain
		}
		hidden_effect = {
			event_target:outraged_FE = {
				add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }
			}
			# Pick an unfortunate neighbor as the punching bag.
			random_country = {
				limit = {
					is_ai = yes
					is_neighbor_of = event_target:outraged_FE
				}
				save_event_target_as = FE_outrager
			}
			if = {
				limit = { NOT = { exists = event_target:FE_outrager} }
				# No neighbors. Pick a different punching bag based on robot pops
				ordered_country = {
					position = 0
					order_by = owner.value:robot_pop_strength_proportion
					limit = {
						is_ai = yes
						is_fallen_empire = no
						is_fallen_empire_machine = no
					}
					save_event_target_as = FE_outrager
				}
			}
			
			event_target:outraged_FE = {
				set_country_flag = holy_world_killed # Not really killed, but this flag let's us wake it up.
				country_event = { id = fallen_empires_awakening.1 days = 40 }
			}
		}
	}
}

# Empire Capitals
# obsessions_midgame.106
# Enclaves
# obsessions_midgame.107
# Relic/Ecu Worlds
# obsessions_midgame.108
# Megastructures
# obsessions_midgame.109
# L-Gates
# obsessions_midgame.110